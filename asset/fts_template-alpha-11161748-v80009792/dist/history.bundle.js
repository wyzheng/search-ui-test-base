(window.webpackJsonp=window.webpackJsonp||[]).push([[237],{1565:function(e,t,n){"use strict";n(920)},2221:function(e,t,n){"use strict";n.r(t);var i=n(24),s=n.n(i),r=n(1),o=n.n(r),a=n(33),c=n.n(a),u=n(23),p=n.n(u),l=n(51),h=n(16),d=n(0),f=n(8),m=n(2),I=n(3),y=n(17),g=n(81),v=n(810),_=n(482),T=n(54),w=n(718),S=n(719);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E="mmsearch_mmsearchcommappsvr_history_input_switch",R={components:{HistoryItem:w.a,HistoryClearItem:S.a,scroll:g.a,exposureBlock:T.a},mixins:[d.k,_.a],props:{selectIndex:{type:Number,default:-1}},data:function(){return{SearchInputId:v.a,historyList:[],showDelete:!1,reportEmpty:!1,pageId:"history".concat(Date.now()),isKeybordShow:!0,hasArrow:!1}},computed:{historyListShow:function(){return this.historyList}},created:function(){var e=this,t=this;if(d.e.get({key:E}).then((function(n){n&&Date.now()-n.timestamp<n.interval_time?e.hasArrow=!!n.ret:t.getXExp()})),f.b.onHisReady((function(t){if(f.a.delHis({isDeleteAll:1}),t.data&&t.data.length&&t.data[0].items.length){var n=t.data[0].items.map((function(e){return{hotword:e.word,id:d.g.generateGuuId().substring(0,13)}}));e.historyList=n,d.e.set({key:e.localStorageKey(),value:n})}})),t.getData(),I.a.$on(I.b.GO_TO_HISTORY,(function(){e.KEYBOARD_HISTORY_REQUESTID="",e.pageId="history".concat(Date.now()),t.getData()})),d.b.scene===m.e.KEYBOARD_HISTORY){var n="";try{n=d.b.parentSearchID?d.b.parentSearchID.split(":").pop():""}catch(e){}this.KEYBOARD_HISTORY_REQUESTID=n}},methods:{localStorageKey:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return d.b.scene===m.h.scene.VERTICAL||d.b.scene===m.h.scene.HOME_TOP_MORE_ENTRY||d.b.scene===m.h.scene.HOME_TOP_ENTRY||d.b.scene===m.h.scene.WXAPP||d.b.scene===m.h.scene.LIVE_INNER_SEARCH?d.b.scene==m.h.scene.LIVE_INNER_SEARCH?"history17":"history".concat(d.b.type):"history".concat(e)},handleTouchmove:function(){var e=this;[m.e.S1S,m.e.GLOBAL_HISTORY,m.e.GLOBAL,m.e.KEYBORD_PRELOAD].includes(d.b.scene)&&Global.os.android&&this.isKeybordShow&&(f.a.setInputBar({query:d.b.query,isInputChange:!1}),this.isKeybordShow=!1,setTimeout((function(){e.isKeybordShow=!0}),1e3))},report:function(e){e=["","",d.b.platform,"","",parseInt(+new Date/1e3),"",""].concat(e),f.a.commonCgi({cgiName:y.a.mmDataReport,data:{clientversion:Number(d.b.clientVersion),device:d.b.deviceType,item_list:[{logid:14884,log_buffer:e.join(",")}]}})},getData:function(e){var t=this;return c()(p.a.mark((function n(){var i,s,r;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=t.localStorageKey(e),n.next=3,d.e.get({key:i});case 3:if(n.t0=n.sent,n.t0){n.next=6;break}n.t0=[];case 6:if(s=n.t0,m.k.includes(d.b.scene)?t.historyList=s.filter((function(e){return m.k.includes(e.scene)})):t.historyList=s.filter((function(e){return!m.k.includes(e.scene)})),t.showDelete=t.historyList.length,t.historyList.length){n.next=18;break}if(d.b.isSupportPermanentData||f.a.getHis({scene:d.b.scene}),!t.reportEmpty){n.next=13;break}return n.abrupt("return");case 13:t.reportEmpty=!0,r=[4,"",d.b.scene,0,"",t.historyList.length,"","",d.b.sessionId,t.KEYBOARD_HISTORY_REQUESTID,t.pageId],t.report(r),n.next=19;break;case 18:f.a.delHis({isDeleteAll:1});case 19:case"end":return n.stop()}}),n)})))()},getXExp:function(){var e=this,t=f.a.commonCgi({cgiName:"GetXexptParamList",data:{key_list:[{key:E}]}});f.b.onCommonCgiReady((function(n){if(n.requestId===t){var i=(n.param_list||[])[0];i&&i.ret&&(e.hasArrow=1==i.value,d.e.set({key:E,value:O(O({},i),{},{interval_time:i.interval_time||7200,timestamp:Date.now()})}))}}))},tapDeleteAll:function(){var e=this;return c()(p.a.mark((function t(){var n,i,s;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.historyList=[],e.showDelete=!1,t.next=4,d.e.get({key:e.localStorageKey()});case 4:if(t.t0=t.sent,t.t0){t.next=7;break}t.t0=[];case 7:(n=t.t0).length&&(i=[],m.k.includes(d.b.scene)?(i=n.filter((function(e){return!m.k.includes(e.scene)})),d.e.set({abskey:"FTSBizClickFlow",value:{}})):i=n.filter((function(e){return m.k.includes(e.scene)})),d.e.set({key:e.localStorageKey(),value:i})),f.a.delHis({isDeleteAll:1}),s=[2,"",d.b.scene,0,"",e.historyList.length,"","",d.b.sessionId,e.KEYBOARD_HISTORY_REQUESTID,e.pageId],e.report(s),e.M_clickReportFor26897("",0,{actionId:m.g.CLICK_CLEAR});case 13:case"end":return t.stop()}}),t)})))()},tapDelete:function(e,t){var n=this;return c()(p.a.mark((function i(){var r,o,a,c;return p.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,r=n.historyList.splice(t,1)[0],n.historyList.length||(n.showDelete=!1),o=n.localStorageKey(),i.next=6,d.e.get({key:o});case 6:(a=i.sent)&&a.length&&(a.forEach((function(e,t){if(e.id==r.id){var n=a.splice(t,1),i=s()(n,1)[0],o=void 0===i?{}:i;m.k.includes(d.b.scene)&&d.e.get({abskey:"FTSBizClickFlow"}).then((function(e){var t=e||{},n=Object.entries(t).find((function(e){var t=s()(e,2);t[0];return t[1].nickname===o.hotword}));n&&(delete t[s()(n,1)[0]],d.e.set({abskey:"FTSBizClickFlow",value:t}))}))}})),d.e.set({key:o,value:a})),f.a.delHis({isDeleteAll:0,query:e.word}),c=["1",encodeURIComponent(r.hotword),d.b.scene,(e.showType||0)+1,r.id,n.historyList.length,encodeURIComponent(r.hotword),t,d.b.sessionId,n.KEYBOARD_HISTORY_REQUESTID,n.pageId],n.report(c),n.M_clickReportFor26897(e,t+1,{actionId:m.g.CLICK_DELETE}),Object(h.f)(l.a.detail.history.hisDel),i.next=18;break;case 15:i.prev=15,i.t0=i.catch(0),i.t0;case 18:case"end":return i.stop()}}),i,null,[[0,15]])})))()},tapItem:function(e,t){if(f.a.setInputBar({query:e.hotword,isInputChange:!1}),d.b.setValue({query:e.hotword,searchId:""}),e.showType)f.a.openView(O(O({},d.b.getBase()),{},{actionType:8,jumpUrl:e.jumpUrl,query:e.hotword}));else if(d.b.scene==m.e.HOME_TOP_ENTRY&&e.source&&Object.keys(e.source||{}).length)this.M_go(e.source);else{var n=[{key:"parentSearchID",textValue:this.M_composeParentSid({t:m.p.SEARCH_HISTORY,s:"",did:e.hotword,rid:this.KEYBOARD_HISTORY_REQUESTID})}];e.mixerCommonContext&&n.push({key:"mixerCommonContext",textValue:e.mixerCommonContext}),e.localAccInfo&&d.b.setValue({localAccExtParams:[{key:"localAccInfo",textValue:e.localAccInfo}]}),I.a.$emit(I.b.GOTO,{page:m.f.RESULT,query:e.hotword,action:m.n.HISTORY,searchId:"",extReqParams:n})}var i=["3",encodeURIComponent(e.hotword),d.b.scene,(e.showType||0)+1,e.id,this.historyList.length,encodeURIComponent(e.hotword),t,d.b.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(i),this.M_clickReportFor26897(e,t+1,e.showType?{actionId:3003}:{},{pageName:m.f.HISTORY}),Object(h.f)(l.a.detail.history.his)},tapArrow:function(e,t){f.a.setInputBar({query:e.hotword,isInputChange:!1}),I.a.$emit(y.c.onInputChange,{query:e.hotword,isInputChange:!1});var n=[5,encodeURIComponent(e.hotword),d.b.scene,(e.showType||0)+1,e.id,this.historyList.length,encodeURIComponent(e.hotword),t,d.b.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(n)},expose:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){var t=[],n=[],i=[];e.forEach((function(e){var r=e.split("$$"),o=s()(r,3),a=o[0],c=o[1],u=o[2];i.push(a),t.push(c),n.push(encodeURIComponent(u))}));var r=[4,"",d.b.scene,0,t.join("|"),this.historyList.length,n.join("|"),i.join("|"),d.b.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(r)}}}},C=(n(1565),n(4)),k=Object(C.a)(R,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("scroll",{attrs:{expose:e.expose,"expose-option":{isBindScrollAtContainer:e.os.pc}}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.os.pc&&e.historyListShow.length||e.os.mobile,expression:"os.pc && historyListShow.length || os.mobile"}],staticClass:"history-page",on:{touchmove:e.handleTouchmove}},[n("div",[n("div",{staticClass:"ui-aria-hidden"},[e._v("历史记录")]),n("exposure-block",{attrs:{attr:"data-new-teach-report-id"},on:{expose:e.M_exposeReportFor26897}},e._l(e.historyListShow,(function(t,i){return n("history-item",{key:i,class:{active:i===e.selectIndex},attrs:{title:t.hotword,desc:t.jumpUrl,"has-arrow":e.hasArrow,"data-expose-id":i+"$$"+t.id+"$$"+t.hotword,"data-new-teach-report-id":""+e.M_getItemReportId(t,i+1)},on:{tap:function(n){return e.tapItem(t,i)},"tap:delete":function(n){return e.tapDelete(t,i)},"tap:arrow":function(n){return e.tapArrow(t,i)}},nativeOn:{mouseover:function(t){return e.$emit("hover",i)}}})})),1),e.showDelete?n("history-clear-item",{attrs:{wrapper:"label",for:e.SearchInputId},nativeOn:{click:function(t){return e.tapDeleteAll.apply(null,arguments)}}}):e._e()],1)])])}),[],!1,null,null,null);t.default=k.exports},482:function(e,t,n){"use strict";var i=n(1),s=n.n(i),r=n(24),o=n.n(r),a=n(2),c=n(19),u=n(0),p=n(3);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={computed:{isCache:function(){var e;return(null===(e=this.$store.state.teach.teachData)||void 0===e?void 0:e.isCache)||!1}},methods:{M_genClickId:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=this.$route.name==a.f.SUG?null===(e=this.$store)||void 0===e||null===(t=e.state)||void 0===t||null===(n=t.sug)||void 0===n?void 0:n.sugId:u.b.searchId;return[i.searchId||s,i.timestamp||+new Date,"".concat(Math.random()).substr(2,10)].join("-")},M_getItemReportId:function(e,t,n){var i=this.M_getBlockType(n);return[this.M_getBlockReportId(n,i),this.M_getItemReportContent(e,t,i)].join("$$")},M_getBlockReportId:function(e,t){var n=e||this,i=n.targetPos||n.displayPos||n.typePos||0,s=n.block&&n.block.title||n.data&&n.data.title||"";return t==c.a.teachType.HISTORY_IN_SINGLE_PAGE?(i=i||1,s=s||"搜索历史"):this.M_getPageType()==c.a.pageType.SUGGESTION&&(s=s||"SUG"),"".concat(i,"|").concat(t,"|").concat(encodeURIComponent(s))},M_getItemReportContent:function(e,t,n){if(!e)return"";var i=e.isDisplay||0,s=e.reason||"",r=e.docPullType||"",o=t||0,a=t||0,u=encodeURIComponent(e.nickName||e.appname||e.hotword||e.word||""),p=this.M_getDocType(e,n),l=e.username||e.userName||e.jumpInfo&&e.jumpInfo.username||e.jumpInfo&&e.jumpInfo.userName||"",h=e.appuin,d=e.appid||e.jumpInfo&&e.jumpInfo.appid||"",f=e.id||"",m=h||d||l||encodeURIComponent(f)||u||"";return n===c.a.teachType.BIZ_HOT_LIST&&(m="".concat(e.bizuin,"_").concat(e.msgid,"_").concat(e.idx)),"".concat(o,"|").concat(a,"|").concat(m,"|").concat("","|").concat(i,"|").concat(u,"|").concat(s,"|").concat("","|").concat(p,"|").concat(r)},M_exposeReportFor26897:function(e){if(e.length&&!this.disable26897()){var t=this,n={};e.forEach((function(e){var t=e.split("$$"),i=o()(t,2),s=i[0],r=i[1];s&&(n[s]=(n[s]||[]).concat([r]))})),p.a.$emit(p.b.TEACH_NEW_EXPOSE,{reportMap:n,isCache:t.isCache}),Object.keys(n).forEach((function(e){u.f.teach.commonTeachReport({itemInfo:e,docInfo:Array.from(new Set(n[e])).join("#"),pageType:t.M_getPageType(),actionId:a.g.EXPOSE_DOC,isCache:t.isCache})}))}},M_clickReportFor26897:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.disable26897(i&&i.pageName||"")){var s=this,r=s.M_getPageType(i&&i.pageName||""),c=n.actionId||this.M_getActionId(e,r),p=this.M_getItemReportId(e,t,i),l=p.split("$$"),d=o()(l,2),f=d[0],m=d[1],I=n.clickId||s.M_genClickId(n);s.$store.commit({type:"teach/updateState",clickReportId:I});var y=this.getJumpParamFor25661(e,c);c>=3001&&c<=3019&&u.f.reportJumpType(Object.assign({subType:null==f?void 0:f.split("|")[1],pageType:r,docId:null==m?void 0:m.split("|")[2],newSearchType:a.h.searchType.DOC_SEARCH},y)),u.f.teach.commonTeachReport(h(h({itemInfo:f,docInfo:m,actionId:c,pageType:r},n),{},{isCache:s.isCache,extInfo:encodeURIComponent(JSON.stringify({clickId:I}))}))}},M_getActionId:function(e,t){var n,i=(null==e?void 0:e.jumpType)||(null==e||null===(n=e.jumpInfo)||void 0===n?void 0:n.jumpType)||0;return i?3e3+parseInt(i):[c.a.pageType.SUGGESTION,c.a.pageType.HISTORY].includes(t)?[a.e.GLOBAL,a.e.KEYBOARD_HISTORY,a.e.GLOBAL_HISTORY,a.e.GLOBAL_RECOMMEND,a.e.GLOBAL_HIS_S1S_ENTRY,a.e.FINGER,a.e.S1S].includes(u.b.scene)?a.g.ALL_SEARCH:a.g.VERTICAL:a.g.CLICK_COMMON},M_getDocType:function(e,t){var n,i=(n={},s()(n,a.h.jumpType.WE_APP,c.a.docItemType.WEAPP),s()(n,a.h.jumpType.BIZ,c.a.docItemType.BIZ),n),r=e.jumpType||e.jumpInfo&&e.jumpInfo.jumpType||0;return e.docType?e.docType:this.getDocTypeByBlockType(t)?this.getDocTypeByBlockType(t):r?i[r]:this.M_getPageType()==c.a.pageType.SUGGESTION?c.a.docItemType.SUGGEST_WORD:"title"},getDocTypeByBlockType:function(e){switch(e){case c.a.teachType.HISTORY:case c.a.teachType.HISTORY_IN_SINGLE_PAGE:return c.a.docItemType.HISTORY_WORD;case c.a.teachType.HOTWORD:case c.a.teachType.RECOMMEND_BOX:return c.a.docItemType.SUGGEST_WORD;case c.a.teachType.FINDER_HOT_LIST:return c.a.docItemType.FINDER_HOT_VIDEO;case c.a.teachType.PAGE_SETTING:return c.a.docItemType.SETTING;case c.a.teachType.BIZ_HOT_LIST:return c.a.docItemType.MP;default:return""}},M_getBlockType:function(e){var t=e||this,n=t.block&&t.block.type||t.data&&t.data.type||0;return t.pageName!=a.f.HISTORY&&this.$route.name!=a.f.HISTORY||(n=c.a.teachType.HISTORY_IN_SINGLE_PAGE),n},M_getPageType:function(e){switch(e||this.$route.name){case a.f.HISTORY:return c.a.pageType.HISTORY;case a.f.SUG:return c.a.pageType.SUGGESTION;default:return c.a.pageType.TEACH}},disable26897:function(e){return this.M_getPageType(e)==c.a.pageType.HISTORY&&![a.e.HOME_TOP_ENTRY,a.e.LIVE_INNER_SEARCH].includes(u.b.scene)},getJumpParamFor25661:function(e,t){var n=e.jumpInfo||{},i=e.jumpType||n.jumpType||t-3e3,s=a.h.jumpType,r={};switch(i){case s.BIZ:r.bizUsername=n.userName||e.userName;break;case s.WE_APP:r.weappUsername=n.userName||n.username||e.userName||e.username,r.jumpPath=n.weappUrl||n.relativeURL||e.weappUrl||e.relativeURL;break;case s.H5:r.jumpUrl=n.jumpUrl||e.jumpUrl;break;case s.CALL_SPEC_API:r.apiName=n.api,r.apiParams=encodeURIComponent(n.apiParams)}var o=[s.VERTICAL,s.ALL_SEARCH];return h(h({},r),{},{jumpType:i,clickType:o.includes(i)?2:1,newSearchType:o.includes(i)?a.h.searchType.DOC_SEARCH:""})}}};t.a=d},646:function(e,t,n){},649:function(e,t,n){},650:function(e,t,n){},718:function(e,t,n){"use strict";var i={props:{title:{type:String,default:""},tags:{type:Array,default:function(){return[]}},desc:{type:String,default:""},hasArrow:{type:Boolean,default:!1},hasDelete:{type:Boolean,default:!0},deleteIconProps:{type:Object,default:function(){return{}}}}},s=(n(743),n(4)),r=Object(s.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"active",rawName:"v-active.instant",modifiers:{instant:!0}}],staticClass:"weui-cell history-item active__item",on:{click:function(t){return t.stopPropagation(),e.$emit("tap",t)}}},[n("div",{staticClass:"weui-cell__hd",attrs:{"aria-hidden":"true"}},[n("svg-icon",{staticClass:"history__icon",attrs:{name:"clock"}})],1),n("div",{staticClass:"weui-cell__bd",attrs:{role:"button"}},[n("div",{staticClass:"history__title"},[n("span",{staticClass:"ellipsis_1",attrs:{"aria-label":e.title}},[e._v(e._s(e.title))]),e.tags.length?n("ui-tags",{staticClass:"history__tags",attrs:{tags:e.tags,flex:""}}):e._e()],1),e.desc?n("div",{staticClass:"history__desc"},[e._v(e._s(e.desc))]):e._e()]),e.hasArrow||e.hasDelete?n("div",{staticClass:"weui-cell__ft"},[e.hasArrow?n("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"active__opacity",attrs:{role:"button","aria-label":"添加到搜索栏"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.$emit("tap:arrow",t)}}},[n("svg-icon",{staticClass:"history__icon",attrs:{name:"arrow.up.left"}})],1):e._e(),e.hasDelete?n("div",e._b({directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"active__opacity",attrs:{role:"button","aria-label":"删除"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.$emit("tap:delete",t)}}},"div",e.deleteIconProps,!1),[n("svg-icon",{staticClass:"history__icon",attrs:{name:"cross"}})],1):e._e()]):e._e()])}),[],!1,null,"3da37edc",null);t.a=r.exports},719:function(e,t,n){"use strict";var i=n(0),s={name:"HistoryClearItem",props:{wrapper:{type:String,default:"div"},title:{type:String,default:i.g.L("清除历史")},hideClearIcon:{type:Boolean,default:!1}}},r=(n(744),n(4)),o=Object(r.a)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(e.wrapper,{directives:[{name:"active",rawName:"v-active.instant",modifiers:{instant:!0}}],tag:"component",staticClass:"weui-cell history-action active__item",attrs:{role:"button","aria-label":e.title}},[e.hideClearIcon?e._e():n("svg-icon",{staticClass:"history-action__icon",attrs:{name:"trashcan","aria-hidden":"true"}}),e._v("\n  "+e._s(e.title)+"\n  "),e._t("default")],2)}),[],!1,null,"cc615e62",null);t.a=o.exports},740:function(e,t,n){"use strict";n(646)},743:function(e,t,n){"use strict";n(649)},744:function(e,t,n){"use strict";n(650)},810:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(0),s=n(17),r=n(2),o=n(21),a={name:"SearchBar",components:{History:function(){var e=o.a.startImport("history");return n.e(237).then(n.bind(null,2221)).then((function(t){return o.a.afterImport(e,"history"),t}))},Suggestion:function(){var e=o.a.startImport("suggestion");return n.e(244).then(n.bind(null,2166)).then((function(t){return o.a.afterImport(e,"suggestion"),t}))}},data:function(){return{SearchInputId:u,typingInput:"",searchInput:"",lastInput:"",lastVertType:null,inputTimer:null,inputFocus:!1,showHistory:!0,showSuggestion:!1,selectIndex:-1,selectInput:"",transferred:!1,customActive:!1}},computed:{hisList:function(){return this.$refs.History&&this.$refs.History.historyListShow||[]},sugList:function(){return this.$refs.Sug&&this.$refs.Sug.suggestoinObj||[]},selectList:function(){try{return this.showHistory?this.hisList.map((function(e){return e.hotword})):this.sugList.reduce((function(e,t){var n=t.items,i=void 0===n?[]:n;return e.concat(i.map((function(e){return e.word||e.nickName})))}),[])}catch(e){return[]}},selectHisItem:function(){try{return this.showHistory&&this.selectIndex>=0?this.hisList[this.selectIndex]:null}catch(e){return null}},selectSugItem:function(){try{return this.showSuggestion&&this.selectIndex>=0&&this.sugList.reduce((function(e,t){var n=t.items,i=void 0===n?[]:n;return e.concat(i)}),[])[this.selectIndex]||null}catch(e){return null}},input:{get:function(){return this.selectInput||this.searchInput},set:function(e){this.inputFocus=!0,this.changeInput({query:e}),this.toggleHint(!e),this.clearSelect()}},isIndex:function(){return this.$route.name===r.f.INDEX},currentVert:function(){var e,t,n=this.isIndex?this.$store.state.index.vertEntries:this.$store.state.result.category,s=n.find((function(e){return e.selected}))||n.find((function(e){return e.type==i.b.type||e.businessType==i.b.type}))||n[0]||{};return{word:null!==(e=s.word)&&void 0!==e?e:s.hotword,type:null!==(t=s.type)&&void 0!==t?t:s.businessType}},placeholder:function(){var e="en"===i.b.lang?" ":"",t=this.currentVert,n=t.type?t.word:"";return"".concat(i.g.L("搜索")).concat(e).concat(n)}},watch:{$route:function(){var e=i.g.getUrlParamsResultOption();e.query!==this.searchInput&&this.changeInput(e)}},created:function(){this.searchInput=i.b.query||i.b.queryString.query||"",i.a.$on(s.c.onInputChange,this.changeInput),i.a.$on(s.c.onInputConfirm,this.onGoto),i.a.$on(i.j.GOTO,this.onGoto),i.a.$on(i.j.SEARCH_BAR_TRANSFER,this.transferDom),i.a.$on(i.j.SEARCH_BAR_ACTIVE,this.toggleActive),i.a.$on(i.j.BACK_BUTTON_CLICK,this.hideHint),i.a.$on(i.j.goToPageIndex,this.focusInput),window.addEventListener("mousedown",this.hideHint),window.addEventListener("blur",this.hideHint),window.addEventListener("focus",this.focusWhenIndex)},mounted:function(){document.dispatchEvent(new Event(i.j.SEARCH_BAR_READY))},methods:{transferDom:function(e){e&&(e.appendChild(this.$refs.SearchForm),this.transferred=!0,this.focusWhenIndex())},focusInput:function(e){var t=this;e&&(e.reset||e.clear)&&(this.clearInput(),this.clearSelect(),this.hideHint()),setTimeout((function(){t.$refs.SearchInput.focus()}))},focusWhenIndex:function(){this.isIndex&&this.focusInput()},onFocus:function(e){this.inputFocus=e,this.toggleHint()},onCancel:function(){!this.inputFocus&&this.input&&(this.input=""),this.clearSelect(),this.inputFocus=!1},onGoto:function(e){this.hideHint(e)},hideHint:function(e){var t=this;e&&e.query&&(this.searchInput=e.query),this.selectInput&&(this.searchInput=this.selectInput,this.emitInput()),e&&e.path&&(e.path.includes(this.$refs.SearchForm)||e.path.some((function(e){return e.htmlFor&&e.htmlFor===u})))||this.$nextTick((function(){t.$refs.SearchInput.blur(),t.inputFocus=!1}))},changeInput:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.query||e.word||"";this.searchInput=t,this.typingInput=t},clearInput:function(){this.searchInput="",this.typingInput="",this.toggleHint(!0)},toggleHint:function(e){this.inputFocus&&(this.showHistory=!this.searchInput,this.showSuggestion=!!this.searchInput,(e||this.searchInput)&&this.emitInput())},toggleActive:function(e){this.customActive=e&&document.activeElement===this.$refs.SearchInput},emitInput:function(){var e=this;this.inputFocus||(this.inputFocus=!0),this.clearSelect(),this.inputTimer&&window.clearTimeout(this.inputTimer),this.inputTimer=setTimeout((function(){e.lastInput===e.searchInput&&e.lastVertType===e.currentVert.type||(e.lastInput=e.searchInput,e.lastVertType=e.currentVert.type,i.a.$emit(s.c.onInputChange,{query:e.searchInput,isInputChange:!0}))}),100)},emitSearch:function(e){if(this.emitSelect(),this.searchInput){if("btn"===e)this.emitConfirm(r.n.PC_SEARCH_BAR);else try{this.selectSugItem?this.$refs.Sug.tapIndex(this.selectIndex):this.selectHisItem?this.$refs.History.tapItem(this.selectHisItem):this.emitConfirm(void 0,r.p.ENTER_INPUT_CONFIRM)}catch(e){this.emitConfirm(void 0,r.p.ENTER_INPUT_CONFIRM)}this.hideHint()}else this.focusInput()},emitConfirm:function(e,t){i.a.$emit(i.j.GOTO,{page:r.f.RESULT,query:this.searchInput||"",action:e,parentType:t,searchId:""})},onSelect:function(e){if(this.inputFocus){var t=this.selectList.length;if(t){var n=this.selectIndex;-1===n?n=e>0?0:t-1:0===n&&e<0||n===t-1&&e>0?n=-1:n+=e,this.selectIndex=n,this.selectInput=this.selectList[n]||""}}else this.onFocus(!0)},emitSelect:function(){this.searchInput=this.selectInput||this.searchInput},alterSelect:function(e){this.selectIndex=e},clearSelect:function(){this.selectInput="",this.selectIndex=-1}}},c=(n(740),n(4)),u=(Object(c.a)(a,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.transferred,expression:"transferred"}],ref:"SearchForm",staticClass:"search",on:{mousedown:function(t){!e.inputFocus&&e.onFocus(!0)}}},[n("div",{staticClass:"search-area"},[n("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.input,expression:"input",modifiers:{trim:!0}}],ref:"SearchInput",class:{empty:!e.typingInput&&!e.input},attrs:{id:e.SearchInputId,type:"text",name:"query",autocomplete:"off",placeholder:e.placeholder},domProps:{value:e.input},on:{input:[function(t){t.target.composing||(e.input=t.target.value.trim())},function(t){e.typingInput=t.target.value}],keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:(t.preventDefault(),e.onCancel.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"tab",9,t.key,"Tab")?null:e.hideHint()},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:(t.preventDefault(),e.onSelect(-1))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:(t.preventDefault(),e.onSelect(1))}],keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.emitSearch.apply(null,arguments)},blur:function(t){return e.$forceUpdate()}}}),n("label",{directives:[{name:"show",rawName:"v-show",value:e.input,expression:"input"},{name:"active",rawName:"v-active"}],staticClass:"search-area-clear weui-icon-clear active__opacity",attrs:{for:e.SearchInputId},on:{click:e.clearInput}}),n("button",{on:{mousedown:function(e){e.stopPropagation()},click:function(t){return t.stopPropagation(),e.emitSearch("btn")}}},[e._v(e._s(e._f("L")("搜索")))]),n("label",{class:["search-area-bg",{active:e.inputFocus||e.customActive}],attrs:{for:e.SearchInputId}})]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.inputFocus&&(e.showSuggestion||e.showHistory),expression:"inputFocus && (showSuggestion || showHistory)"}],staticClass:"search-hint",on:{mouseout:function(t){return e.alterSelect(-1)}}},[n("suggestion",{directives:[{name:"show",rawName:"v-show",value:e.showSuggestion&&e.sugList.length,expression:"showSuggestion && sugList.length"}],ref:"Sug",attrs:{"select-index":e.selectIndex},on:{hover:e.alterSelect}}),n("history",{directives:[{name:"show",rawName:"v-show",value:e.showHistory,expression:"showHistory"}],ref:"History",attrs:{"select-index":e.selectIndex},on:{hover:e.alterSelect}})],1)])}),[],!1,null,"0941b748",null).exports,"weixin-search-input")},920:function(e,t,n){}}]);