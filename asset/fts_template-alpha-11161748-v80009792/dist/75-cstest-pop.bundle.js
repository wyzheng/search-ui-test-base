(window.webpackJsonp=window.webpackJsonp||[]).push([[264],{1432:function(t,e,n){},1433:function(t,e,n){},1434:function(t,e,n){},2058:function(t,e,n){"use strict";n(1432)},2059:function(t,e,n){"use strict";n(1433)},2060:function(t,e,n){"use strict";n(1434)},2127:function(t,e,n){"use strict";n.r(e);var a=n(1),s=n.n(a),r=n(0),i=n(8),o=n(25),c={props:{data:{type:Object,default:function(){return{}}},stars:{type:Array,default:function(){return[]}}},data:function(){return{sWord:null,selected:!1,isShowSkip:!0,rank:0,height:"auto"}},watch:{sWord:function(){setTimeout(this.reCalHeight)}},mounted:function(){this.reCalHeight()},methods:{reCalHeight:function(){var t=this;setTimeout((function(){t.$refs.inner.clientHeight})),t.height="".concat(t.$refs.inner.clientHeight,"px")},tapStar:function(t,e){var n=this;n.rank=e+1,e<3?(n.sWord="".concat(t.word,"，请选择原因"),n.isShowSkip=!1):(n.sWord=t.word,n.selected&&(n.isShowSkip=!1)),n.$emit("tapStar",{index:e}),n.selected=!0},tapSkip:function(){this.$emit("tapSkip")}}},u=(n(2058),n(4)),l=Object(u.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"stars",style:{height:t.height}},[n("div",{ref:"inner",staticClass:"star-inner"},[n("div",{staticClass:"star-wrap",class:{"star-wrap__selected":t.sWord&&t.rank<4}},t._l(t.stars,(function(e,a){return n("div",{key:e.word,staticClass:"star-item expand-hotspot expand-hotspot-star",attrs:{role:"button","aria-label":e.word},on:{click:function(n){return t.tapStar(e,a)}}},[n("svg-icon",{staticClass:"star",class:{star__fill:e.selected},attrs:{name:"star"}}),t.sWord?t._e():n("p",{staticClass:"start-text",attrs:{"aria-hidden":"true"}},[t._v("\n          "+t._s(e.word)+"\n        ")])],1)})),0),t.sWord?n("div",{staticClass:"tip",class:{gold:t.rank>3},attrs:{role:"option","aria-live":"polite","aria-label":"已选择，"+t.sWord}},[t._v("\n      "+t._s(t.sWord)+"\n    ")]):t._e(),t.isShowSkip?n("div",{staticClass:"skip"},[n("span",{staticClass:"expand-hotspot",attrs:{role:"button"},on:{click:t.tapSkip}},[t._v("跳过评价")])]):t._e()])])}),[],!1,null,"1a53fd73",null).exports;function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h={mixins:[r.m],props:{data:{type:Object,default:function(){return{}}},reasons:{type:Array,default:function(){return[]}},rank:{type:Number,default:Number}},methods:{tapReason:function(t){this.$emit("tapReason",{index:t})},tapMore:function(t){var e=this;e.$emit("tapMore");var n=e.reasons.filter((function(t){return t.selected||t.jumpUrl})).map((function(t){return t.wording})).join("|");e.M_jump(Object.assign(t,{jumpUrl:e.M_composeUrl(t.jumpUrl,d({selected_items:n,templateId:e.data.templateId,rank:e.rank},r.b.getBase()))}))}}},f=(n(2059),Object(u.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"heavy-links reasons"},t._l(t.reasons,(function(e,a){return n("div",{key:e.title,staticClass:"heavy-link",attrs:{role:"button"},on:{click:function(e){return t.tapReason(a)}}},[e.jumpUrl?n("div",{staticClass:"heavy-link__inner reason__arrow with-arrow",on:{click:function(n){return t.tapMore(e)}}},[n("span",[t._v(t._s(e.wording))])]):n("div",{staticClass:"heavy-link__inner reason",class:{reason__selected:e.selected},attrs:{"aria-label":(e.selected?"已选定，":"")+e.wording}},[t._v("\n      "+t._s(e.wording)+"\n    ")])])})),0)}),[],!1,null,"4cda92de",null).exports),m=n(42),b=n(17),w=n(59);function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){s()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y,_={components:{stars:l,reasons:f,heightAnimate:m.a},mixins:[r.m],data:function(){return Object.assign({asyncData:null,stars_:[],rank:0,reasons_:[],duration:0,firstClickStar:!0,isShowReason:!0,isShowReasonAndButton:!1,confirmed:!1,isPopShowing:!1},{startTime:+new Date})},computed:g(g({},Object(o.c)({requestId:function(t){return t.result.requestId||t.result.previousRid},resultObj:function(t){return t.result.self.resultObj},popupTestObj:function(t){return t.result.insert.insertPopTestData}})),{},{templateContent:function(){return this.asyncData&&this.asyncData.templateContent||{}},pop:function(){return this.templateContent.pop||{}},header:function(){return{close:!0,title:this.pop.title}},stars:{get:function(){return this.stars_.length?this.stars_:this.pop.rank?this.pop.rank.map((function(t){return{word:t,selected:0}})):[]},set:function(t){this.stars_=t}},reasons:{get:function(){return this.reasons_.length?this.reasons_:this.pop.richReasons?this.pop.richReasons.map((function(t){return Object.assign({selected:0},t)})):[]},set:function(t){this.reasons_=t}}}),created:function(){var t=this;setTimeout((function(){t.handleResultReady()}),0),i.b.onClientShadowClick((function(){t.isPopShowing&&t.hidePop().then((function(){t.asyncData=null}))}))},methods:{reset:function(){Object.assign(this.$data,{asyncData:null,stars_:[],rank:0,reasons_:[],duration:0,firstClickStar:!0,isShowReason:!0,isShowReasonAndButton:!1,confirmed:!1,isPopShowing:!1})},listenNavCtrl:(y=!1,function(){var t=this;y||w.a.on((function(e){t.handleClientNavAction(e)})),y=!0}),handleResultReady:function(){var t=this,e=t.resultObj.asyncFeedback;if(!t.isPopShowing){if(t.reset(),t.popupTestObj)return t.asyncData=t.popupTestObj,void t.listenNavCtrl();t.asyncData||e&&r.h.getCommonCgiData({cgiName:"GetSessionSurvey",data:g(g({},r.b.getBase()),{},{clientH5Version:r.b.version})}).then((function(e){var n=e.data;r.g.isObjectEmpty(n)||(n&&n.templateContent&&(t.asyncData=n),t.listenNavCtrl())}))}},handleClientNavAction:function(t){var e=this;if(!e.isPopShowing)if(e.asyncData){e.duration=new Date-e.startTime;var n=e.pop.duration||3e3;e.duration<n?t():e.showPop()}else t()},showPop:function(){this.isPopShowing=!0,this.$refs._halfScreen.show(),Global.os.ios?r.h.openView({actionType:1,opType:2,userName:"",nickName:""}):Global.os.android&&r.h.setInputBar({query:r.b.query,isInputChange:!1}),r.h.showNavBarShadow({color:"#000000",alpha:.5,animateDuration:.3}),console.warn("弹窗曝光上报"),this.report({reportType:"expose",reasons:this.reasons.map((function(t){return t.wording}))})},hidePop:function(){var t=this;return new Promise((function(e){r.h.hideNavBarShadow({animateDuration:.3}),t.$refs._halfScreen.hide(),setTimeout((function(){e(),t.isPopShowing=!1}),300)}))},terminate:function(){var t=this;t.hidePop().then((function(){w.a.next(),t.asyncData=null}))},tapStar:function(t){var e=this,n=t.index;e.rank=n+1,e.stars=e.stars.map((function(t,e){return e<=n?Object.assign(t,{selected:1}):Object.assign(t,{selected:0})})),n<3?e.firstClickStar?e.isShowReasonAndButton=!0:e.isShowReason=!0:e.firstClickStar?setTimeout((function(){e.confirm()}),500):e.isShowReason=!1,e.firstClickStar=!1},tapReason:function(t){var e=t.index;this.reasons=this.reasons.map((function(t,n){return n==e?Object.assign(t,{selected:!t.selected}):t}))},tapMore:function(){var t=this;t.hidePop().then((function(){t.asyncData=null}))},confirm:function(){var t=this;t.confirmed=!0,t.report({duration:+new Date-t.startTime}),setTimeout((function(){t.terminate()}),300)},report:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this;r.h.getCommonCgiData({cgiName:b.a.reportInserData,data:Object.assign({reportType:"click",templateType:e.templateContent.type,reportLogId:18811,scene:r.b.scene,query:r.b.query,searchId:r.b.searchId,sessionId:r.b.sessionId,requestId:e.requestId,homepage:r.b.isHomePage,timestamp:+new Date,templateId:e.asyncData.templateId,rank:e.rank,reasons:e.rank>3?[]:e.reasons.filter((function(t){return t.selected})).map((function(t){return t.wording})),duration:0},t)})}}},k=(n(2060),Object(u.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.asyncData&&t.asyncData.templateContent?n("div",[n("ui-half-screen",{ref:"_halfScreen",attrs:{"can-scroll":!0,header:t.header,"class-name":"cstest-pop-content"},on:{"tap:close":t.terminate,"tap:mask":t.terminate}},[n("div",{staticClass:"pop",class:{pop__confirm:t.confirmed}},[n("stars",{attrs:{data:t.asyncData,stars:t.stars},on:{tapStar:t.tapStar,tapSkip:t.terminate}}),n("heightAnimate",{directives:[{name:"show",rawName:"v-show",value:t.isShowReasonAndButton,expression:"isShowReasonAndButton"}],staticClass:"wrap",attrs:{duration:300,name:"popWrap"}},[t.isShowReason?n("heightAnimate",{attrs:{duration:300,name:"popReason"}},[n("reasons",{staticClass:"reasons",attrs:{data:t.asyncData,reasons:t.reasons,rank:t.rank},on:{tapReason:t.tapReason,tapMore:t.tapMore}})],1):t._e(),n("div",{staticClass:"btn-wrap"},[n("div",{staticClass:"weui-btn weui-btn_primary btn",attrs:{role:"button"},on:{click:t.confirm}},[t._v("\n            提交\n          ")])])],1)],1),t.confirmed?n("div",{staticClass:"feedback",attrs:{role:"option","aria-live":"polite"}},[n("svg-icon",{staticClass:"cs-feedback__tick",attrs:{name:"tick"}}),n("div",{staticClass:"cs-feedback__text"},[t._v("\n        已提交\n      ")])],1):t._e()])],1):t._e()}),[],!1,null,"43480faf",null));e.default=k.exports}}]);